---
import { getCollection } from "astro:content";
import { groupBy, sortBy } from "es-toolkit";
import DefaultPageLayout from "../layouts/DefaultPageLayout.astro";
import type { CollectionEntry } from "astro:content";
import DividedHorizontalToolList from "../components/DividedHorizontalToolList.astro";
import ToolsGridLarge from "../components/ToolsGridLarge.astro";
import { Icon } from "astro-icon/components";

type Tool = CollectionEntry<"tools">;

function mainToolsFilter(tool: Tool): Tool | undefined {
  // Only tools that don't have a parent tool are displayed on tools page
  if (!tool.data.parentTool || tool.data.favorite) {
    return tool;
  }
  return undefined;
}

/**
 * Tools that are displayed on tools page.
 */
const mainTools = sortBy(
  (await getCollection("tools", mainToolsFilter)) ?? [],
  ["id"],
);

const groupedTools = groupBy(mainTools, ({ data }) => data.usageStatus);
---

<DefaultPageLayout title="Tools">
  <div class="prose-content">
    <h1>Tools</h1>
    <h2>Current Toolkit</h2>
    <p>
      These are tools I actively use to build things. You can select some of
      them to see how I've configured them to my liking. Tools marked with <Icon
        class="inline text-theme-primary"
        name="material-symbols/favorite-outline-rounded"
      /> are ones I especially like or are essential to my work and I highly recommmend
      checking them out.
    </p>
    <p>Feel free to explore, copy and get inspired!</p>
    <ToolsGridLarge tools={groupedTools.inToolbox} />
    {
      groupedTools.onTheShelf?.length && (
        <>
          <h2>On the Shelf</h2>
          <p>
            These are tools that are used in projects I maintain or that I
            occasionally reach for when need arises.
          </p>
          <DividedHorizontalToolList
            class="not-prose-content mt-8"
            tools={groupedTools.onTheShelf}
          />
        </>
      )
    }
    <div class="mt-16">
      <h2>Stored Away</h2>
      <p>
        These are tools I've used previously but are not in active use for some
        reason. I've listed them here for historical purposes and to showcase
        how far I and the industry have come. Maybe some of them will return to
        my toolbox in the future.
      </p>
      <DividedHorizontalToolList
        class="not-prose-content mt-8"
        tools={groupedTools.storedAway}
      />
    </div>
  </div>
</DefaultPageLayout>
